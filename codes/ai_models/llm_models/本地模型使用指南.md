# 智诊通系统本地模型使用指南

## 📁 模型存储结构

```
codes/ai_models/llm_models/
├── llm_models/                    # 大语言模型目录
│   └── Medical_Qwen3_17B/        # 医疗专用大语言模型
└── embedding_models/              # 向量化模型目录
    └── text2vec-base-chinese/    # 中文文本向量化模型
```

## 🤖 模型列表

### Llm Models

#### Qwen2-0.5B-Medical-MLX
- **描述**: 医疗专用大语言模型，基于Qwen2-0.5B微调
- **大小**: 34GB
- **状态**: ✅ 已安装
- **路径**: `/Users/tiangels/AI/llm_learning_project/zhi_zhen_tong_system/codes/ai_models/llm_models/llm_models/Qwen2-0.5B-Medical-MLX`

### Embedding Models

#### text2vec-base-chinese
- **描述**: 中文文本向量化模型
- **大小**: 400MB
- **状态**: ✅ 已安装
- **路径**: `/Users/tiangels/AI/llm_learning_project/zhi_zhen_tong_system/codes/ai_models/llm_models/embedding_models/text2vec-base-chinese`

## 🔧 配置说明

### 自动配置更新

模型管理器会自动更新以下配置文件中的模型路径：

1. **RAG服务配置**: `codes/services/knowledge_retrieval_service/api/config/rag_config.json`
2. **统一配置**: `codes/ai_models/embedding_models/config/unified_config.json`
3. **医疗配置**: `codes/ai_models/embedding_models/config/medical_knowledge_config.json`
4. **向量配置**: `codes/ai_models/embedding_models/config/vector_config.json`

### 手动配置

如果需要手动配置模型路径，请确保路径指向正确的模型目录。

## 🚀 使用方法

### 1. 检查模型状态

```python
from model_manager import ModelManager

manager = ModelManager()
models = manager.list_models()
print(models)
```

### 2. 更新配置文件

```python
# 使用本地模型路径更新所有配置文件
manager.update_config_files(use_local_models=True)
```

### 3. 验证模型完整性

```python
# 检查特定模型是否存在且完整
exists = manager.check_model_exists("Medical_Qwen3_17B", "llm_models")
print(f"模型存在: {exists}")
```

## 📋 模型详细信息

### Medical_Qwen3_17B

- **类型**: 大语言模型 (LLM)
- **用途**: 医疗问答、诊断建议、健康咨询
- **特点**: 基于Qwen3-17B微调，专门针对医疗场景优化
- **内存需求**: 建议32GB+ RAM
- **GPU支持**: 支持CUDA加速

### text2vec-base-chinese

- **类型**: 文本向量化模型
- **用途**: 文本嵌入、语义搜索、文档检索
- **特点**: 中文优化，支持医疗文本向量化
- **内存需求**: 建议4GB+ RAM
- **GPU支持**: 可选

## 🔍 故障排除

### 常见问题

1. **模型文件不完整**
   - 检查模型目录是否存在
   - 验证必需文件是否齐全
   - 重新下载缺失的模型文件

2. **配置文件路径错误**
   - 运行 `manager.update_config_files()` 自动更新
   - 手动检查配置文件中的路径设置

3. **内存不足**
   - 减少批处理大小
   - 使用CPU推理
   - 关闭其他应用程序

### 日志查看

```bash
# 查看模型管理器日志
tail -f logs/model_manager.log

# 查看RAG服务日志
tail -f codes/services/knowledge_retrieval_service/logs/rag_service.log
```

## 📞 技术支持

如果遇到问题，请检查：
1. 模型文件完整性
2. 配置文件路径
3. 系统资源使用情况
4. 依赖包版本

---

**更新时间**: 2024年9月11日  
**版本**: 1.0.0  
**状态**: ✅ 就绪
