# 智诊通系统 - 项目启动指南

## 📋 目录

- [系统概述](#系统概述)
- [环境要求](#环境要求)
- [快速启动](#快速启动)
- [详细启动步骤](#详细启动步骤)
  - [后端服务启动](#后端服务启动)
  - [前端服务启动](#前端服务启动)
- [验证系统运行](#验证系统运行)
- [常用命令](#常用命令)
- [故障排除](#故障排除)
- [开发环境配置](#开发环境配置)

## 🎯 系统概述

**智诊通**是一个基于人工智能的多模态智能医生问诊系统，采用前后端分离架构：

- **后端**: Python + FastAPI + PostgreSQL
- **前端**: Vue 3 + TypeScript + Ant Design Vue
- **通信**: RESTful API + WebSocket
- **部署**: Docker支持

## 🛠️ 环境要求

### 基础环境

| 软件 | 版本要求 | 说明 |
|------|----------|------|
| **Python** | 3.8+ | 后端运行环境 |
| **Node.js** | 18.0+ | 前端构建环境 |
| **npm** | 8.0+ | 前端包管理器 |
| **Git** | 2.0+ | 代码版本控制 |

### 可选环境

| 软件 | 版本要求 | 说明 |
|------|----------|------|
| **Docker** | 20.0+ | 容器化部署 |
| **Redis** | 6.0+ | 缓存服务 |
| **PostgreSQL** | 13.0+ | 生产数据库 |

### 操作系统支持

- ✅ **macOS** 10.15+
- ✅ **Ubuntu** 18.04+
- ✅ **Windows** 10+ (WSL2推荐)
- ✅ **CentOS** 7+

## 🚀 快速启动

### 方式一：一键启动（推荐）

```bash
# 1. 克隆项目
git clone <repository-url>
cd zhi_zhen_tong_system

# 2. 一键启动所有服务
cd codes
chmod +x start-all.sh
./start-all.sh
```

### 方式二：Docker启动

```bash
# 1. 使用Docker Compose
cd codes
docker-compose up -d

# 2. 查看服务状态
docker-compose ps
```

## 📝 详细启动步骤

### 后端服务启动

#### 1. 环境准备

```bash
# 进入后端目录
cd codes/backend

# 检查Python版本
python3 --version  # 应该是3.8+
```

#### 2. 创建虚拟环境（推荐）

```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
# macOS/Linux:
source venv/bin/activate
# Windows:
# venv\Scripts\activate
```

#### 3. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt

# 验证安装
pip list | grep fastapi
```

#### 4. 数据库初始化

```bash
# 创建数据库表（如果不存在）
python3 -c "
from app.database import create_tables
create_tables()
print('✅ 数据库初始化完成')
"
```

#### 5. 启动后端服务

```bash
# 方式一：开发模式启动
chmod +x start-dev.sh
./start-dev.sh

# 方式二：手动启动
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

# 方式三：后台启动
nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload > logs/backend.log 2>&1 &
```

#### 6. 验证后端服务

```bash
# 健康检查
curl http://localhost:8000/health

# 查看API文档
open http://localhost:8000/docs
```

### 前端服务启动

#### 1. 环境准备

```bash
# 进入前端目录
cd codes/frontend

# 检查Node.js版本
node --version  # 应该是18.0+
npm --version   # 应该是8.0+
```

#### 2. 安装依赖

```bash
# 安装前端依赖
npm install

# 验证安装
npm list vue
```

#### 3. 环境配置（可选）

```bash
# 复制环境配置文件
cp env.example .env

# 编辑配置文件
# vim .env
```

#### 4. 启动前端服务

```bash
# 方式一：开发模式启动
chmod +x start-dev.sh
./start-dev.sh

# 方式二：手动启动
npm run dev

# 方式三：后台启动
nohup npm run dev > ../backend/logs/frontend.log 2>&1 &
```

#### 5. 验证前端服务

```bash
# 检查服务状态
curl http://localhost:8080

# 打开浏览器
open http://localhost:8080
```

## ✅ 验证系统运行

### 1. 服务端点检查

| 服务 | 地址 | 状态检查 |
|------|------|----------|
| **前端界面** | http://localhost:8080 | 打开浏览器访问 |
| **后端API** | http://localhost:8000 | `curl http://localhost:8000/health` |
| **API文档** | http://localhost:8000/docs | 查看Swagger文档 |

### 2. 功能验证

```bash
# 1. 用户注册测试
curl -X POST "http://localhost:8000/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test",
    "email": "test@example.com",
    "password": "test123456"
  }'

# 2. 用户登录测试
curl -X POST "http://localhost:8000/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test",
    "password": "test123456"
  }'
```

### 3. 系统状态监控

```bash
# 查看系统状态
cd codes
./status.sh

# 查看日志
tail -f backend/logs/backend.log
tail -f backend/logs/frontend.log
```

## 🔧 常用命令

### 服务管理

```bash
# 启动所有服务
./start-all.sh

# 查看服务状态
./status.sh

# 停止所有服务
./stop-all.sh

# 重启服务
./stop-all.sh && ./start-all.sh
```

### 开发调试

```bash
# 后端开发
cd codes/backend
source venv/bin/activate
python3 -m uvicorn app.main:app --reload --log-level debug

# 前端开发
cd codes/frontend
npm run dev

# 代码格式化
npm run format
npm run lint
```

### 日志查看

```bash
# 实时查看后端日志
tail -f codes/backend/logs/backend.log

# 实时查看前端日志
tail -f codes/backend/logs/frontend.log

# 查看系统日志
tail -f codes/logs/*.log
```

## 🔧 故障排除

### 常见问题

#### 1. 端口占用

```bash
# 查看端口占用
lsof -i :8000  # 后端端口
lsof -i :8080  # 前端端口

# 杀死占用进程
kill -9 <PID>
```

#### 2. 依赖安装失败

```bash
# Python依赖问题
pip install --upgrade pip
pip cache purge
pip install -r requirements.txt --force-reinstall

# Node.js依赖问题
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

#### 3. 数据库问题

```bash
# 重新创建数据库
rm codes/backend/*.db
cd codes/backend
python3 -c "
from app.database import create_tables
create_tables()
"
```

#### 4. 权限问题

```bash
# 给脚本执行权限
chmod +x codes/*.sh
chmod +x codes/backend/*.sh
chmod +x codes/frontend/*.sh
```

### 错误日志分析

#### 后端错误

```bash
# 查看详细错误日志
cd codes/backend
tail -100 logs/backend.log

# 常见错误解决
# - 数据库连接失败：检查数据库文件权限
# - 模块导入错误：检查虚拟环境和依赖
# - 端口占用：更换端口或杀死占用进程
```

#### 前端错误

```bash
# 查看详细错误日志
cd codes/frontend
tail -100 ../backend/logs/frontend.log

# 常见错误解决
# - 编译错误：检查TypeScript语法
# - 依赖错误：重新安装node_modules
# - 网络错误：检查后端API连接
```

## 🔧 开发环境配置

### IDE配置推荐

#### VS Code插件

```json
{
  "recommendations": [
    "ms-python.python",
    "Vue.volar",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-typescript-next",
    "esbenp.prettier-vscode"
  ]
}
```

#### PyCharm配置

1. 配置Python解释器为虚拟环境
2. 启用FastAPI支持
3. 配置代码格式化工具

### 环境变量配置

#### 后端环境变量 (.env)

```bash
# 数据库配置
DATABASE_URL=sqlite:///./zhizhentong.db

# JWT配置
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# API配置
API_V1_STR=/api/v1
PROJECT_NAME=智诊通系统

# 日志配置
LOG_LEVEL=INFO
```

#### 前端环境变量 (.env)

```bash
# API配置
VITE_API_BASE_URL=http://localhost:8000
VITE_API_TIMEOUT=10000

# 应用配置
VITE_APP_TITLE=智诊通系统
VITE_APP_VERSION=1.0.0
```

### Git配置

```bash
# 配置Git钩子
cd .git/hooks
cp pre-commit.sample pre-commit
chmod +x pre-commit

# 配置忽略文件
echo "
# 日志文件
*.log

# 数据库文件
*.db

# 环境文件
.env

# 临时文件
.DS_Store
" >> .gitignore
```

## 📞 技术支持

如果遇到问题，请按以下顺序排查：

1. **查看本文档的故障排除部分**
2. **检查系统日志文件**
3. **查看项目Issue列表**
4. **联系开发团队**

---

**开发团队**: 智诊通开发团队  
**更新时间**: 2024年  
**文档版本**: 1.0.0
